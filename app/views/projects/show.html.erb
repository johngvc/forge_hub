<div class="container-new">
  <section>
    <div class="container-new project-intro">
      <div class="project-title-desc">
        <h1><%=  @project.name %></h1>
        <p><%= @project.description %></p>
      </div>

  <% if @is_not_participant && @has_join_request == false %>

    <div style="margin-top: 30px; margin-bottom: 30px; display: flex; flex-direction: row; justify-content: center;">
      <button type="button" class="btn btn-success" data-toggle="modal" data-target="#projectAskModal" style="width: 180px;">ask to join this project!</button>
    </div>

  <% elsif @is_participant && @participant.status == 'founder' %>

    <div style="margin-top: 30px; margin-bottom: 30px; display: flex; flex-direction: row; justify-content: center;">

      <%= link_to edit_project_path(id: @project.id) do %>
        <div class="btn btn-success", style="width: 180px">edit this project!</div>
      <% end %>

      <%= link_to project_destroy_path(id: @project.id), method: :delete, data: { confirm: "Are you sure you want to permanently delete this project?" } do %>
        <div class="btn btn-success", style="width: 180px">delete this project!</div>
      <% end %>
    </div>
  <% end %>
    </div>
  </section>

  <section class="project-call-img">
    <div class=project-img-container>
      <% if @project.photo.attached? %>
        <%= cl_image_tag @project.photo.key, class: "project-img" %>
      <% else %>
        <%= image_tag "https://res.cloudinary.com/johngvc/image/upload/v1614792257/Mesa_ikvzhp.jpg", class: "project-img" %>
      <% end %>
    </div>

  <% if @is_not_participant && @has_join_request == false %>
    <div class="project-call-container">
      <div class="container-new">
        <div class="project-apply">
          <h2><%= User.find(@project.user_id).name %> wants to make <%= @project.name %> a reality</h2>
          <button class="ask-to-join-btn" data-toggle="modal" data-target="#projectAskModal">
            Ask to join this project!
          </button>
  <% end %>

          <div class="social-links">
          <% if @project.linkedin_url.empty? %>
            <a href="<%= @project.linkedin_url %>">
              <i class="fa fa-linkedin"></i>
            </a>
          <% end %>
          <% if @project.github_url.empty? %>
            <a href="<%= @project.github_url %>">
                <i class="fa fa-github"></i>
            </a>
          <% end %>
          <% if @project.trello_url.empty? %>
            <a href="<%= @project.trello_url %>">
                <i class="fa fa-trello"></i>
            </a>
          <% end %>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div style="margin-top: 30px; margin-bottom: 30px; display: flex; flex-direction: column;">

    <h2>Project members:</h2>

    <% if @project_participants.empty? %>
      <p><%= "There are no registered members of #{@project.name}"%></p>

    <% else %>
      <%= link_to "click here for a detailed list of project members", project_participants_path(project_id: @project.id) %>

      <ul>
        <% @project_participants.each do |participant| %>

          <% if participant.status == 'founder' %>

            <% if !participant.user.photo.attached? %>
              <li><%= image_tag "https://res.cloudinary.com/johngvc/image/upload/v1614782060/florencia-potter-yxmNWxi3wCo-unsplash_jhoyej.jpg", class: "avatar" %><%= link_to "             #{participant.user.name}", profile_path(id: participant.user.id) %><%= "- founder"%></li>

            <% else %>
              <li><%= cl_image_tag participant.user.photo.key, class: "avatar" %><%= link_to "             #{participant.user.name}", profile_path(id: participant.user.id) %><%= "- founder"%></li>
            <% end %>

          <% elsif participant.status == 'cofounder' %>

            <% if !participant.user.photo.attached? %>
              <li><%= image_tag "https://res.cloudinary.com/johngvc/image/upload/v1614782060/florencia-potter-yxmNWxi3wCo-unsplash_jhoyej.jpg", class: "avatar" %><%= link_to "             #{participant.user.name}", profile_path(id: participant.user.id) %><%= "- cofounder"%></li>

            <% else %>
              <li><%= cl_image_tag participant.user.photo.key, class: "avatar" %><%= link_to "             #{participant.user.name}", profile_path(id: participant.user.id) %><%= "- cofounder"%></li>
            <% end %>

          <% elsif participant.status == 'member' %>

            <% if !participant.user.photo.attached? %>
              <li><%= image_tag "https://res.cloudinary.com/johngvc/image/upload/v1614782060/florencia-potter-yxmNWxi3wCo-unsplash_jhoyej.jpg", class: "avatar" %><%= link_to "             #{participant.user.name}", profile_path(id: participant.user.id) %><%= "- member"%></li>

            <% else %>
              <li><%= cl_image_tag participant.user.photo.key, class: "avatar" %><%= link_to "             #{participant.user.name}", profile_path(id: participant.user.id) %><%= "- member"%></li>
            <% end %>

          <% elsif participant.status == 'invitee' %>

            <% if !participant.user.photo.attached? %>
              <li><%= image_tag "https://res.cloudinary.com/johngvc/image/upload/v1614782060/florencia-potter-yxmNWxi3wCo-unsplash_jhoyej.jpg", class: "avatar" %><%= link_to "             #{participant.user.name}", profile_path(id: participant.user.id) %><%= "- temporary invitee, membership confirmation pending"%></li>

            <% else %>
              <li><%= cl_image_tag participant.user.photo.key, class: "avatar" %><%= link_to "             #{participant.user.name}", profile_path(id: participant.user.id) %><%= "- temporary invitee, membership confirmation pending"%></li>
            <% end %>
          <% end %>
        <% end %>
      </ul>
    <% end %>
  </div>


  <!-- Modal -->
  <div class="modal fade" id="projectAskModal" tabindex="-1" role="dialog" aria-hidden="true">

    <div class="modal-dialog" role="document">

      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">send the founders a message asking to join this project</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">

            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <%= form_tag project_join_request_do_path(project_id: @project, id: @project_participants.first.id), method: :post do %>

          <div class="modal-body">

            <div class="input-group">
              <textarea class="form-control" name="request_message"></textarea>
            </div>
          </div>

          <div class="modal-footer">
            <input type="submit" class="btn btn-success" value="send message">
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <!-- Modal -->

  <% unless @join_requests.first.nil? || @join_requests.nil? %>
    <%= render partial: 'join_request_pending', locals: { project: @project, join_requests: @join_requests, number: @number } %>
  <% end %>
</div>

